# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a React-based browser game called "認識合わせゲーム" (Recognition Matching Game). The game uses ChatGPT API to generate topics, and players try to give matching answers. Players can answer using either text or drawings (similar to the game "Lounge").

### Project Structure
```
.
├── front/              # Frontend application (React + Vite)
│   ├── src/           # Source code
│   │   ├── App.jsx            # Main application component
│   │   ├── DrawingCanvas.jsx  # Drawing canvas component
│   │   └── ...
│   └── package.json
├── infrastructure/     # AWS deployment infrastructure
│   ├── cloudformation.yaml    # CloudFormation template (S3 + CloudFront)
│   ├── deploy-infra.sh       # Infrastructure deployment script
│   └── deploy-frontend.sh    # Frontend deployment script
└── README.md
```

### Game Flow
The game operates in three distinct states managed by `gameState` in front/src/App.jsx:
1. **setup**: Player configuration and topic generation
2. **answering**: All players input their answers (text or drawing) to the generated topic
3. **judging**: Host reviews all answers and judges if they match, then proceeds to next round or ends game

## Development Commands

All frontend development commands should be run from the `front/` directory:

```bash
cd front

# Install dependencies
npm install

# Start development server (runs on http://localhost:5173)
npm run dev

# Build for production
npm run build

# Preview production build
npm run preview
```

## Architecture

### State Management
All game state is managed in a single component (`front/src/App.jsx`) using React hooks:
- `gameState`: Controls which screen is displayed (setup/answering/judging)
- `players`: Array of player objects with `{id, name, answer, answerType, drawingData}`
  - `answerType`: 'text' or 'drawing'
  - `drawingData`: Base64-encoded image data for drawings
- `topic`: Current topic generated by ChatGPT
- `judged`: Boolean indicating if current round has been judged
- `lastJudgeResult`: Result of the last judgment (true/false)

### Frontend Components
1. **App.jsx**: Main application component containing all game logic
2. **DrawingCanvas.jsx**: HTML5 Canvas-based drawing component
   - Supports color selection (6 colors)
   - Line width adjustment (3 sizes)
   - Clear functionality
   - Exports drawings as Base64-encoded PNG

### OpenAI API Integration
The app makes direct fetch calls to OpenAI's Chat Completions API from the browser. The API key is loaded from environment variable `VITE_OPENAI_API_KEY` (defined in `front/.env`).

The `generateTopic()` function uses GPT-3.5-turbo with a system prompt that instructs it to generate topics in the format "〇〇といえば?" (What comes to mind when you think of...?).

### Current Limitations
- This is a single-user prototype where one person controls all player inputs
- No network/multiplayer functionality yet (designed for future WebSocket implementation)
- Manual judgment by host - no automatic answer matching algorithm

## Environment Setup

The OpenAI API key must be set in `front/.env`:
```
VITE_OPENAI_API_KEY=your-api-key-here
```

## AWS Deployment

This project includes CloudFormation templates and scripts for deploying to AWS (S3 + CloudFront):

```bash
# Deploy infrastructure (first time only)
cd infrastructure
./deploy-infra.sh

# Deploy frontend (after code changes)
./deploy-frontend.sh
```

See `infrastructure/README.md` for detailed deployment instructions.

## Future Plans
Per siyou.txt, the eventual goal is to add WebSocket support for real multi-player simultaneous connections, but the current version is intentionally single-user for testing purposes.
