schema {
  query: Query
  mutation: Mutation
}

#  回答情報
type Answer {
  answerId: ID!
  answerType: AnswerType!
  drawingData: String
  playerId: ID!
  playerName: String!
  roomId: ID!
  #  Base64エンコードされた画像
  submittedAt: AWSDateTime!
  textAnswer: String
}

type DeleteAllDataResponse {
  deletedCounts: DeletedCounts!
  message: String!
  success: Boolean!
}

type DeletedCounts {
  answers: Int!
  players: Int!
  rooms: Int!
}

#  判定結果
type JudgeResult {
  isMatch: Boolean!
  judgedAt: AWSDateTime!
  roomId: ID!
}

#  Mutations
type Mutation {
  #  ルームを作成（ホスト用）
  createRoom(hostName: String!): Room!
  #  全データを削除（開発用）
  deleteAllData: DeleteAllDataResponse!
  #  ゲームを終了（ホストのみ）
  endGame(roomId: ID!): Room!
  #  判定用コメントを非同期生成（ホストのみ）
  generateJudgingComments(roomId: ID!): JudgeResult!
  #  ルームに参加（プレイヤー用）
  joinRoom(playerName: String!, roomCode: String!): Player!
  #  判定を実行（ホストのみ）
  judgeAnswers(isMatch: Boolean!, roomId: ID!): JudgeResult!
  #  プレイヤーを追放（ホストのみ）
  kickPlayer(kickedPlayerId: ID!, playerId: ID!, roomId: ID!): Boolean!
  #  ルームから退出
  leaveRoom(playerId: ID!, roomId: ID!): Boolean!
  #  次のラウンドへ（ホストのみ）
  nextRound(roomId: ID!): Room!
  #  ゲームを開始（ホストのみ）- お題プールを生成してゲーム開始
  startGame(roomId: ID!): Room!
  #  判定画面に遷移（ホストのみ）
  startJudging(roomId: ID!): Room!
  #  回答を提出
  submitAnswer(answerType: AnswerType!, drawingData: String, playerId: ID!, roomId: ID!, textAnswer: String): Answer!
}

#  プレイヤー情報
type Player {
  connected: Boolean!
  joinedAt: AWSDateTime!
  name: String!
  playerId: ID!
  role: PlayerRole!
  roomId: ID!
}

#  Queries
type Query {
  #  ルーム情報を取得
  getRoom(roomId: ID!): Room
  #  ルームコードからルームを取得
  getRoomByCode(roomCode: String!): Room
  #  回答一覧を取得
  listAnswers(roomId: ID!): [Answer!]!
  #  プレイヤー一覧を取得
  listPlayers(roomId: ID!): [Player!]!
}

#  ルーム情報
type Room {
  answers: [Answer!]!
  comments: [String!]
  #  ニコニコ風コメントリスト（オプショナル）
  createdAt: AWSDateTime!
  hostId: ID!
  judgedAt: AWSDateTime
  #  使用済みのお題リスト
  lastJudgeResult: Boolean
  players: [Player!]!
  roomCode: String!
  roomId: ID!
  state: GameState!
  topic: String
  topicsPool: [String!]!
  updatedAt: AWSDateTime!
  #  未使用のお題リスト
  usedTopics: [String!]!
}

enum AnswerType {
  DRAWING
  TEXT
}

#  ゲーム状態
enum GameState {
  ANSWERING
  JUDGING
  WAITING
}

enum PlayerRole {
  HOST
  PLAYER
}
